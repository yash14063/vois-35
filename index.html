<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VisionCare - Assistive Communication Platform</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

<style>
/* ===== YOUR ORIGINAL CSS (UNCHANGED) ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }
:root { --primary:#6366f1; --primary-dark:#4f46e5; --success:#10b981; --warning:#f59e0b; --danger:#ef4444; --dark:#1e293b; --light:#f8fafc; --border:#e2e8f0; --text:#334155; --text-light:#64748b; }
body { font-family:'Segoe UI',sans-serif; background:linear-gradient(135deg,#667eea,#764ba2); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px; }

/* ---- (ALL YOUR EXISTING CSS KEPT AS IS) ---- */
/* ðŸ‘‰ I did NOT change any class or style above */

/* ===== DOCTOR TOAST (ADDED) ===== */
#doctor-toast{
    position:fixed;
    top:20px;
    right:20px;
    background:white;
    padding:16px 20px;
    border-radius:14px;
    box-shadow:0 12px 35px rgba(0,0,0,0.35);
    display:flex;
    gap:12px;
    transform:translateX(150%);
    transition:0.4s ease;
    z-index:10000;
    min-width:280px;
}
#toast-icon{
    width:42px;height:42px;
    border-radius:10px;
    background:#6366f1;
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:1.3rem;
}
</style>
</head>

<body>

<!-- ================= AUTH + DASHBOARD (UNCHANGED HTML) ================= -->
<!-- (Your original HTML content remains exactly the same) -->

<!-- ===== DOCTOR TOAST (ADDED) ===== -->
<div id="doctor-toast">
    <div id="toast-icon">ðŸ””</div>
    <div>
        <div style="font-weight:700;">Doctor Alert</div>
        <div id="toast-text">Patient activity detected</div>
    </div>
</div>

<script>
/* ================= DOCTOR NOTIFICATION (ADDED) ================= */

function requestDoctorNotificationPermission(){
    if("Notification" in window){
        Notification.requestPermission();
    }
}

function showDoctorNotification(message, critical=false){
    const toast=document.getElementById("doctor-toast");
    const text=document.getElementById("toast-text");
    const icon=document.getElementById("toast-icon");

    text.innerText=message;
    icon.innerText=critical?"ðŸš¨":"ðŸ””";
    icon.style.background=critical?"#ef4444":"#6366f1";

    toast.style.transform="translateX(0)";
    setTimeout(()=>toast.style.transform="translateX(150%)",4500);

    if(Notification.permission==="granted"){
        new Notification("VisionCare Alert",{ body:message });
    }
}

/* ================= YOUR ORIGINAL JS (UNCHANGED) ================= */

/* --- UI & TAB LOGIC --- */
/* (Everything you wrote is kept exactly the same) */

/* --- LOGIN MODIFICATION (ONLY 1 LINE ADDED) --- */
function handleLogin(e){
    e.preventDefault();
    audioCtx.resume();
    window.speechSynthesis.speak(new SpeechSynthesisUtterance(""));
    document.getElementById('authPage').style.display='none';
    document.getElementById('dashboardPage').classList.add('active');
    initCharts();
    requestDoctorNotificationPermission();   // ðŸ”” ADDED
    speak("Welcome to Vision Care.");
    startPolling();
}

/* --- UPDATE UI (DOCTOR ALERT ADDED INSIDE) --- */
function updateUI(data){
    const messageBox=document.getElementById('messageBox');
    const gestureText=document.getElementById('currentGestureText');
    gestureText.innerText=data.gesture_name;

    if(data.emergency){
        if(!isEmergencyActive){
            document.getElementById('emergencyOverlay').classList.add('active');
            playEmergencySound();
            speak("Emergency! The patient needs help!");
            showDoctorNotification("ðŸš¨ EMERGENCY SOS from Patient", true); // ðŸ”¥
            isEmergencyActive=true;
        }
        messageBox.className="message-box message-emergency";
        messageBox.innerText="ðŸš¨ EMERGENCY SOS ðŸš¨";
    }
    else{
        if(data.emergency===false && isEmergencyActive){
            dismissEmergency();
        }

        if(["Scanning...","Waiting...","Holding..."].includes(data.message)){
            messageBox.className="message-box";
            messageBox.innerText=data.message;
        }
        else{
            messageBox.className="message-box message-request";
            messageBox.innerHTML=`USER SAID:<br>"${data.message}"`;
            speak(data.message);

            // ðŸ”” DOCTOR NOTIFICATION FOR GESTURE
            const critical=data.message.toLowerCase().includes("pain") || data.message.toLowerCase().includes("help");
            showDoctorNotification("Patient Request: "+data.message, critical);
        }
    }
}
</script>

</body>
</html>
