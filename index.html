<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Patient Gesture Assistance</title>

<!-- UI STYLE (UNCHANGED LOOK) -->
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
}
.container {
    display: flex;
    height: 100vh;
}
.left, .right {
    flex: 1;
    padding: 20px;
}
.card {
    background: #020617;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
}
h2 { margin-top: 0; }
.status {
    font-size: 20px;
    margin-top: 10px;
}
.alert {
    color: red;
    font-weight: bold;
}
video {
    width: 100%;
    height: 100%;
    border-radius: 12px;
    object-fit: contain;
    transform: scaleX(-1);
}
button {
    background: #2563eb;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
}
button:hover {
    background: #1d4ed8;
}
</style>

<!-- MEDIAPIPE -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

</head>
<body>

<div class="container">
    <!-- LEFT PANEL -->
    <div class="left">
        <div class="card">
            <h2>Live Assist View</h2>
            <video id="camera" autoplay playsinline muted></video>
        </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right">
        <div class="card">
            <h2>Patient Status</h2>
            <div class="status">Gesture: <span id="gesture">Waiting...</span></div>
            <div class="status">Message: <span id="message">No input</span></div>
            <div class="status alert" id="emergency"></div>
            <br/>
            <button onclick="startSystem()">Start Monitoring</button>
        </div>
    </div>
</div>

<script>
let lastGesture = "";

/* UI UPDATE (ORIGINAL LOGIC PRESERVED) */
function updateUI(data) {
    document.getElementById("gesture").innerText = data.gesture_name;
    document.getElementById("message").innerText = data.message;
    document.getElementById("emergency").innerText =
        data.emergency ? "âš  Emergency Detected!" : "";
}

/* START SYSTEM */
function startSystem() {
    startCameraGesture();
}

/* CAMERA + GESTURE (ADDED WITHOUT DISTURBING UI) */
function startCameraGesture() {
    const video = document.getElementById("camera");

    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => video.srcObject = stream)
        .catch(err => alert("Camera access denied"));

    const hands = new Hands({
        locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
    });

    hands.setOptions({
        maxNumHands: 1,
        minDetectionConfidence: 0.7,
        minTrackingConfidence: 0.7
    });

    hands.onResults(results => {
        if (!results.multiHandLandmarks) return;

        const lm = results.multiHandLandmarks[0];
        let fingers = 0;

        if (lm[8].y < lm[6].y) fingers++;     // Index
        if (lm[12].y < lm[10].y) fingers++;  // Middle
        if (lm[16].y < lm[14].y) fingers++;  // Ring
        if (lm[20].y < lm[18].y) fingers++;  // Pinky
        if (lm[4].x < lm[3].x) fingers++;    // Thumb

        processGesture(fingers);
    });

    const camera = new Camera(video, {
        onFrame: async () => {
            await hands.send({ image: video });
        },
        width: 640,
        height: 480
    });

    camera.start();
}

/* GESTURE MAPPING */
function processGesture(count) {
    const map = {
        5: "I need help",
        4: "I need water",
        3: "I am hungry",
        2: "I feel dizzy",
        1: "Chest pain"
    };

    const msg = map[count] || "Scanning...";
    if (msg === lastGesture) return;
    lastGesture = msg;

    updateUI({
        gesture_name: count + " fingers",
        message: msg,
        emergency: msg.includes("pain")
    });
}
</script>

</body>
</html>
